---
title: "STAT2000: Applied Statistics and Research Methods"
output: 
  html_document: 
    css: Labs.css
params:
  inc_solu:
    label: Include solutions
    value: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

if ( ! require('haven'))
  install.packages('haven')
if ( ! require('car'))
  install.packages('car')
if ( ! require('DunnettTests'))
  install.packages('DunnettTests')

data <- haven::read_sav('Lab 04 - Vocab.sav')
data <- as.data.frame(data)
```

```{block include=(!params$inc_solu)}
<style>
.section.level5 {
  display: none ;
}
</style>
```

# Lab 4 - Week 5

#### Recall Lecture 4:

 - ANOVA Assumptions
   - Diagnostics 
   - Remedial Measures
 - Comparing Means: Post-hoc tests

### Lab Objectives

On completion of this lab you will be able to:

 - Identify and test assumptions for an ANOVA.
 - Identify when multiple comparisons are appropriate.
 - Perform the appropriate multiple comparisons using SPSS and interpret the findings.
 - Recognise the role of Randomisation and Blocking and be able to implement in practice.

### Overview

In the Week 4 lecture we discussed the assumptions underlying oneway fixed effects ANOVA, and how we may check or test these (diagnose) and what action we may take to remedy the situation when assumptions don't hold (remedial measures). We also considered the additional testing, for differences between groups, once the ANOVA identifies that at least one population mean differs (post-hoc tests or multiple comparisons).

## 4.1 Assumptions and Multiple Comparisons

A researcher wanted to test a new approach to increase vocabulary among children with autism. For the experiment, 36 children were randomly assigned to one of three different treatments (Community referrals with No additional Intervention, Low-Intensity Intervention, and High-Intensity Intervention). After a fixed period of time, the increase in the children's vocabulary was measured (the number of additional words spoken over a specified time interval). The results are presented in the following table and in the file Vocab.sav.

  |  No  | Low  | High |
  |------|------|------| 
  |  23  |  23  |  38  |
  |  25  |  20  |  27  |
  |  21  |  25  |  27  |
  |  22  |  21  |  29  |
  |  21  |  22  |  26  |
  |  22  |  23  |  29  |
  |  20  |  21  |  27  |
  |  23  |  20  |  30  |
  |  19  |  19  |  28  |
  |  22  |  20  |  27  |
  |  19  |  22  |  26  |
  |  21  |  21  |  29  |
  
#### 1. State the null and alternative hypotheses for testing.

##### Solutions

Ⓢ 

Since the researcher wishes to test the effect of three new treatments (no, low, high) to increase a child's vocabulary, let

 - $\mu_N$ represent the population mean increase (in words) of a child's vocabulary when no additional intervention (no) has been given.
 - $\mu_L$ represent the population mean increase (in words) of a child's vocabulary when low-intensity intervention (low) has been given.
 - $\mu_H$ represent the population mean increase (in words) of a child's vocabulary when high intensity intervention (high) has been given.

Then the null and alternative hypotheses are

  $H_0$ : $\mu_N = \mu_L = \mu_H$
  
  $H_a$ : at least one population mean increase in vocabulary measurement is
different

NOTE: there are many ways of stating the hypotheses, but you MUST be consistent and define the notation used.

#### 2. Perform an ANOVA on the data. What is the value of the test statistic and the corresponding p-value?

It should be clear that *Increase* is the dependent variable.

Ⓡ construct a model using the `lm()` function, and then pass this model to the `anova()` function.

Ⓥ Analyses → ANOVA → ANOVA.

##### Solutions

Ⓢ 

```{r}
data <- haven::read_sav('Lab 04 - Vocab.sav')
data <- as.data.frame(data)
data$Group <- as.factor(data$Group)

model <- lm(Increase ~ Group, data)
anova(model)
```

From the SPSS output, the test statistic is F = 63.601 and the corresponding p- value is 0.000 to 3 dec places. Thus there is very strong evidence against the null hypothesis.

#### 3. Why is it appropriate to carry out post-hoc tests to compare group means? Which test is most appropriate to test whether those not receiving additional treatment (No Intervention) were different to those receiving Low and High Intensity Interventions? Carry out this test.

Hint: the post-hoc test we want is a *Dunnet's test*.

TODO

##### Solutions

Ⓢ 

The ANOVA F test indicates that there is a difference in population mean increase in vocabulary measurements somewhere among the three group means. Hence it is appropriate to carry out a post-hoc test to determine exactly where the difference(s) lies.

Since we have a control group (i.e., those children where no additional intervention took place) a Dunnett's test is appropriate, rather than Tukey's test.

#### 4. Whenever an ANOVA is performed certain assumptions most hold. Perform a test for unequal variances.

Ⓡ First create side-by-side box-plots and see if it looks like the groups have similar variances, then follow this up with a more formal *Levene's test*; use the `leveneTest()` function from the `car` package. Note that you need to pass the `center='mean'` argument to the `leveneTest()` function to get a "normal" Levene's test.

Ⓥ Using the ANOVA you created in question 2, in the Assumption Checks section, you'll find a checkbox for *Homogeneity tests* (*Equality of variances* is sometimes called *Homogeneity of variances*). Follow this up by producing side-by-side box-plots using the Analyses -> Explore -> Descriptives analysis. Do the two results correspond?

##### Solutions

Ⓢ 

```{r}
library(car)
leveneTest(Increase ~ Group, data, center='mean')

plot(x=data$Group, y=data$Increase)
```

We can see that although the high-intensity intervention group has a smaller sample standard deviation than the other two groups there isn't a large difference.
The ratio of largest standard deviation to smallest is about 1.3 so applying the rule of thumb suggests the ANOVA assumption of equality of population variances is not to be rejected (Moore and McCabe (2009) suggest that as long as the largest standard deviation is less than twice the smallest standard deviation ANOVA will still give approximately correct results.)

The Levene test reports a large p-value 0.741 indicating that the null hypothesis (of equal population variances in each group) should not be rejected.

#### 5. Explain what a residual represents and/or how it is obtained.

##### Solutions

Ⓢ 

In general, a residual is simply the difference between an actual response measurement and the value predicted by the fitted model for the corresponding set of explanatory variables. For one-way ANOVA this is just the difference between the measurement (observation) and its corresponding group mean (sample mean). Thus the jth residual in the ith group is:

$$ e_{ij} = Y_{ij} - \hat Y_{ij} $$

where the $\hat \space$ symbol indicates a predicted value

#### 6. Test the normality of the residuals using Q-Q plot and Shapiro-Wilk goodness of fit tests.

Ⓡ Extract the residuals from the model you created in question 2 with the `residuals()` function. Create a Q-Q plot with the `qqPlot()` function, and test for normality with the `shapiro.test()` function.

Ⓥ Using the ANOVA from question 2, under the *Assumption Checks* section, you'll find checkboxes for a *Q-Q plot* and a *Shapiro-Wilk test*.

##### Solutions

Ⓢ 

```{r eval=FALSE}
resids <- residuals(model)
qqPlot(resids)
shapiro.test(resids)
```

```{r echo=FALSE}
resids <- residuals(model)
qqPlot(resids)
```

Since the residuals lie on the straight line there is evidence that the error terms, for each of the three groups, are normally distributed. However, such a method does not provide a formal test of the assumption, just a visual aid.

```{r echo=FALSE}
shapiro.test(resids)
```

Shapiro-Wilk test has p-value = 0.257, so fail to reject null hypothesis. Conclude there is not enough evidence to reject the null hypothesis and it appears the assumption of normality of the residuals is valid.

#### 7. Write a statement summarising the overall results of your analysis that would be appropriate for inclusion in a report.

##### Solutions

Ⓢ 

The one-way fixed effects analysis of variance provided strong evidence against the null hypothesis (p=0.000) indicating that the population mean of vocabulary improvement is not equal across the three intervention groups. Dunnett's test confirmed that the population mean vocabulary improvement in the High intensity intervention group was statistically significantly higher than the population mean improvement for the for the No intervention group (p-value = 0.000); whilst the population mean vocabulary improvement in the Low intensity intervention was not statistically significantly higher than the population mean improvement for the for the No intervention group (p-value = 0.99).

TODO

#### 8. It was suggested that children in the No Intervention group were still exposed to community referrals and so should NOT be considered as part of a control group. Suppose that it was of interest to compare the effects of the three treatment conditions to each other WITHOUT assuming the "No intervention group" to be the control group. Conduct the appropriate test to determine which of the three groups differed from one another in terms of mean vocabulary improvement.

##### Solutions

Ⓢ 

TODO

If the no intervention group is not treated as a control group, then the post-hoc test that is most appropriate is the Tukey-Kramer HSD method (Tukey in SPSS).

By considering the Tukey-Kramer HSD method (in SPSS, Tukey):

 - There is a statistically significant difference in the vocabulary of those who were in the high-intervention group and the low-intervention group (p=0.000)
 - There is a statistically significant difference in the vocabulary of those who were in the high-intervention group and the no-intervention group (p=0.000)
 - There is no statistically significant difference in the vocabulary of those who
were in the no-intervention group and the low-intervention group (p= 0.991)

## 4.2 Bears in Space

### 4.2.1 Completely Randomised Design

This activity is based around launching small toy koala bears (ok, they aren't bears but Bears in Space is catchier than Koalas in Space) from a ramp in order to study factors that may affect launch distance. The class will be split into 3-4 teams with each team to have the following equipment:

 - one wooden stick about 90 cm long
 - one rubber band
 - one pencil eraser
 - one plastic spoon
 - six koala "bear-o-nauts"
 - one measuring tape
 - one bucket with hole approximately 10 cm above ground level when bucket turned upside down.
 
If there are not enough students for four teams then create two teams and each team should then have twelve "bear-o-nauts".

Each team's first task is to build their launcher.

 1. Loop the rubber band enough times around one end of the launching platform (90cm wooden stick) such that the rubber band stays firmly in place but can still be rolled up and down the stick relatively easily. 
 2. Move (roll) the rubber band to the 40 cm mark. (Caution: Beware of splinters.) 
 3. Put the handle of the plastic spoon under the rubber band and place the eraser between the spoon handle and the stick to act as a fulcrum. 
 4. Ensure the fulcrum is reasonably close to the rubber band so that pulling back and then releasing the spoon will launch the spoon contents, i.e. your bear, into the air.
You now have BLC (bear-o-naut launch capability) but don't start launching yet!
The response variable we are interested in is the launch distance, measured from the front of the launching platform, but only in the direction parallel to the platform.
We will now design and conduct an experiment to determine the effect of raising the end of our launching platform (thus altering height and angle from which bears are launched) a fixed distance.

How many factors are of interest?

We have one factor of interest, height of end of platform.

How many levels does the factor of interest have?

Two levels: zero (horizontal) and raised. The raised level corresponds to the end of the launching platform being supported about 10cm off the ground using the hole in the side of the inverted bucket. The plastic edge should fit into a notch in the end of the launching platform (stick).

We will launch half of our bears at each level. 

Discuss the following points with other members of your group and write a brief but clear procedure for your experiment.

 1. For a completely randomised design, all experimental units (bears) must be randomly allocated among the treatment groups (zero or raised height). Why is this important?
 2. Are you going to launch a set of bears at the zero position, then a set of bears in the raised position or use some other order? Why might this be important to consider?
 3. Based on your discussion of the previous two points, define a method to randomly allocate your bears to launch position and order of launch.
 4. Determine the exact procedure you will follow (an operational definition) to launch your bears and allocate jobs to group members. Possible jobs include holding the launching platform steady, loading the bear, launching the bear, measuring the distance travelled (in the direction parallel to the launching platform), monitoring alignment of measurement, recording of data, etc. Why is it important to develop, and follow, a careful protocol that tells exactly how the experiment is to be done?
 
Carefully launch your bears and record your measurements. 

Analyse your data appropriately and write a brief report.

### 4.2.2 Randomised Block Design

TODO

For each group, launching three bears at each level, it is unlikely you were able to detect a difference in mean launch distance -– we need greater power!  However, together we have greater power -- as a class we have access to much more data.

 1. With the help of your tutor, combine data from all groups (teams) into a single SPSS data file and undertake a one-way fixed effects ANOVA.
 
     - Has the increase in the amount of data provided sufficient evidence that raising the end of the launch platform causes a change in the average launch distance?
   
 2. Can you see a problem with the combined analysis? Hint: What source of variation has not been accounted for in the analysis?
 
     - Explain what a blocking variable is and why 'team' (or 'group') can be considered a blocking variable in this example.
   
 3. Re-analyse the combined data but consider 'team' as a blocking variable. 
 
     - In SPSS, identify 'team' as another fixed effect. 
     - As do not wish to test for an interaction between team and height select MODEL option and in resulting pop-up window select 'Custom'
     - Highlight the two variables. Ensure 'Type' is 'Main Effects' before including in the model. 

 4. Including the blocking variable in the above manner gives us an ANOVA with two factors. Although we haven't explicitly covered two-way ANOVA yet, it is basically an extension of the knowledge you have of one-way ANOVA. 
Consider the row in the ANOVA table corresponding to raising the end of the launch platform. What is the p-value and your conclusion about the effect of 'team' on launch distance? How has specifying the blocking variable changed the results?

 5. Based on your analysis, what is the effect of team on launch distance?

### 4.3 Group Project

Time in this lab has been allocated for further discussions with your group members. Hopefully you are close to deciding on an appropriate scenario for your project. The Bears in Space exercise shows that an experiment does not have to be difficult or expensive. (Note: Copies or simple derivatives of this experiment are not acceptable project scenarios.)

Once you have a basic idea for a project scenario you need to refine it by defining your response variable(s) and explanatory variable(s). What relationship between variables might be useful to explore? How will you measure the variables? Can you create an operational definition for each variable?

Many researchers will consult statisticians when planning studies. Use your tutor as a sounding board now or during help session times (see Blackboard for times and locations!).

### 4.4 Homework

In labs we have considered data from studies of the following:

 - the food energy content for two different brands of vanilla yoghurt.
 - tonnes of wheat reaped for plots treated with one of three different types of fertiliser.
 - the head widths (in millimetres) of a species of tiger beetle (Cicindela circumpicta) from three different localities.

For each study:

 1. state whether it is appropriate to carry out a post-hoc comparison of means along with an explanation for your decision (HINT: it is only appropriate for one of the studies);
 2. carry out the multiple comparisons in SPSS for the relevant study;
 3. review how well the data met the assumptions of the statistical analysis.
